<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>cJMS</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="bk-tos-esb-mediationcomponents-rg-en..html" title="Talend Open Studio"><link rel="up" href="ch-messaging.html" title="Chapter&nbsp;3.&nbsp;Messaging components"><link rel="prev" href="cHttp.html" title="cHttp"><link rel="next" href="cMail.html" title="cMail"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">cJMS</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="cHttp.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Messaging components</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="cMail.html">Next</a></td></tr></table><hr></div><div lang="EN" class="section" title="cJMS"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cJMS"></a>cJMS</h2></div></div></div><div class="mediaobject"><img src="../images/cjms_icon32_white.png"></div><div class="section" title="cJMS properties"><div class="titlepage"><div><div><h3 class="title"><a name="d2670e5730"></a>cJMS properties</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Component Family</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Messaging</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Function</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>
								<span class="emphasis"><strong>cJMS</strong></span> allows messages to be sent to, or consumed from, a JMS Queue or Topic.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Purpose</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>
								<span class="emphasis"><strong>cJMS</strong></span> is used to send messages to,
								or consume messages from, a JMS Queue or Topic.</p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>URI/Type</em></span>
							</p>
						</td><td valign="top">
							<p>Select the messaging type, either <span class="emphasis"><strong>queue</strong></span> or <span class="emphasis"><strong>topic</strong></span>.</p>
						</td></tr><tr><td>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p>
								<span class="emphasis"><em>URI/Destination</em></span>
							</p>
						</td><td valign="top">
							<p>Type in a name for the JMS queue or topic. </p>
						</td></tr><tr><td>&nbsp;</td><td valign="top">
							<span class="emphasis"><em>ConnectionFactory</em></span>
						</td><td valign="top">Click the three-dot button and select a JMS connection factory to be used for handling messages or enter the name of the corresponding <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component directly in the field.</td></tr><tr><td>
							<span class="emphasis"><strong>Advanced settings</strong></span>
						</td><td valign="top">
							<span class="emphasis"><em>URI Options</em></span>
						</td><td valign="top">Set the optional arguments in the corresponding table. Click <span class="emphasis"><strong>[+]</strong></span> as many times as required to add arguments to the table. Then click the corresponding value field and enter a value. See the site <a class="link" href="http://camel.apache.org/jms.html" target="_top">http://camel.apache.org/jms.html</a> for available URI options.</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Usage</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p><span class="emphasis"><strong>cJMS</strong></span> can be a start, middle or
								end component in a Route.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Limitation</strong></span>
							</p>
						</td><td colspan="2">
							<p>&nbsp;n/a</p>
						</td></tr></tbody></table></div></div><div class="section" title="Scenario 1: Sending and receiving a message from a JMS queue"><div class="titlepage"><div><div><h3 class="title"><a name="nwang-20111014-camel_components-cjms_s1"></a>Scenario 1: Sending and receiving a message from a JMS queue</h3></div></div></div><p>In this scenario, a <span class="emphasis"><strong>cJMS</strong></span> component sends messages from the local file system to a message queue in one sub-route, and the messages are then consumed by another <span class="emphasis"><strong>cJMS</strong></span> component in the other sub-route.</p><div class="mediaobject"><img src="../images/use_case_cjms1.png"></div><div class="section" title="Dropping and linking the components"><div class="titlepage"><div><div><h4 class="title"><a name="d2670e5906"></a>Dropping and linking the components</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>From the <span class="emphasis"><strong>Palette</strong></span>, expand the <span class="emphasis"><strong>Context</strong></span> folder, and drop a <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component onto the design workspace to specify the JMS connection factory for handling messages.</p></li><li class="step" title="Step 2"><p>From the <span class="emphasis"><strong>Messaging</strong></span> folder, drop one <span class="emphasis"><strong>cFile</strong></span> and two <span class="emphasis"><strong>cJMS</strong></span> components onto the design workspace.</p></li><li class="step" title="Step 3"><p>From the <span class="emphasis"><strong>Processor</strong></span> folder, drop a <span class="emphasis"><strong>cProcessor</strong></span> component onto the design workspace.</p></li><li class="step" title="Step 4"><p>Connect the <span class="emphasis"><strong>cFile</strong></span> component to a <span class="emphasis"><strong>cJMS</strong></span> component using a <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span> connection as the message producer sub-route.</p></li><li class="step" title="Step 5"><p>Connect the other <span class="emphasis"><strong>cJMS</strong></span> component to the <span class="emphasis"><strong>cProcessor</strong></span> component using a <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span> connection as the message consumer sub-route.</p></li><li class="step" title="Step 6"><p>Label the components properly for better identification of their functionalities.</p></li></ol></div></div><div class="section" title="Configuring the components"><div class="titlepage"><div><div><h4 class="title"><a name="d2670e5976"></a>Configuring the components</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component to display its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case_cjms1bis.png"></div></li><li class="step" title="Step 2"><p>From the <span class="emphasis"><strong>MQ Server</strong></span> list, select an MQ server. In this use case, we use the default ActiveMQ server to handle the messages. </p><p>In the <span class="emphasis"><strong>Broker URI</strong></span> field, type in the URI of the message
						broker. Here we simply use the default URI <span class="emphasis"><em>"vm://localhost?broker.persistent=false"</em></span>.</p></li><li class="step" title="Step 3"><p>In the message producer sub-route, double-click the <span class="emphasis"><strong>cFile</strong></span> component to display its <span class="emphasis"><strong>Basic settings</strong></span> view.</p><div class="mediaobject"><img src="../images/use_case_cjms2.png"></div></li><li class="step" title="Step 4"><p>Define the properties of the <span class="emphasis"><strong>cFile</strong></span>
						component. </p><p>In this use case, simply specify the path to the folder that holds the source file to be sent as electronic message, and leave the other parameters as they are.</p></li><li class="step" title="Step 5"><p>Double-click the <span class="emphasis"><strong>cJMS</strong></span> component labeled <span class="emphasis"><em>Message_producer</em></span> to display its <span class="emphasis"><strong>Basic settings</strong></span> view.</p><div class="mediaobject"><img src="../images/use_case_cjms3.png"></div></li><li class="step" title="Step 6"><p>From the <span class="emphasis"><strong>Type</strong></span> list, select <span class="emphasis"><strong>queue</strong></span> to send the messages to a JMS queue.</p><p>In the <span class="emphasis"><strong>Destination</strong></span> field, type in a name for the JMS queue, <code class="code">"queue.hello"</code> in this use case.</p><p>Double-click the <span class="emphasis"><strong>[...]</strong></span> button next to <span class="emphasis"><strong>ConnectionFactory</strong></span>. Select the JMS connection
						factory that you have just configured in the dialog box and click <span class="emphasis"><strong>OK</strong></span>. You can also enter the name of the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component directly in the
						field.</p><div class="mediaobject"><img src="../images/use_case_cjms8.png"></div></li><li class="step" title="Step 7"><p>Switch to the message consumer sub-route, and double click the <span class="emphasis"><strong>cJMS</strong></span> component  labeled <span class="emphasis"><em>Message_consumer</em></span> to display its <span class="emphasis"><strong>Basic settings</strong></span> view.</p><div class="mediaobject"><img src="../images/use_case_cjms4.png"></div></li><li class="step" title="Step 8"><p>Configure the message consumer using exactly the same parameters as in the message producer. </p></li><li class="step" title="Step 9"><p>Double-click the <span class="emphasis"><strong>cProcessor</strong></span> component to display its <span class="emphasis"><strong>Basic settings</strong></span> view.</p><div class="mediaobject"><img src="../images/use_case_cjms5.png"></div></li><li class="step" title="Step 10"><p>In the <span class="emphasis"><strong>Code</strong></span> area, customize the code as shown below to display the file names of the consumed messages on the <span class="emphasis"><strong>Run</strong></span> console.</p><p>
						</p><pre class="programlisting">System.out.println("Message consumed: "+
exchange.getIn().getHeader("CamelFileName"));</pre><p>
					</p></li><li class="step" title="Step 11"><p>Press <span class="emphasis"><strong>Ctrl+S</strong></span> to save your Routes.</p></li></ol></div></div><div class="section" title="Viewing code and executing the Route"><div class="titlepage"><div><div><h4 class="title"><a name="d2670e6128"></a>Viewing code and executing the Route</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Click the <span class="emphasis"><strong>Code</strong></span> tab at the bottom of the
						design workspace to have a look at the generated code. </p><div class="mediaobject"><img src="../images/use_case_cjms6_1.png"></div><div class="mediaobject"><img src="../images/use_case_cjms6_2.png"></div><p>In the partially shown code, a message route is built <code class="code">from</code> the <code class="code">File_source</code>
						<code class="code">.to</code> the <code class="code">Message_producer</code> which then sends the message to a message queue via a broker identified by <code class="code">vm://localhost?broker.persistent=false</code>. The message <code class="code">from</code> the <code class="code">Message_consumer</code> is processed by <code class="code">cProcessor_1</code>. </p></li><li class="step" title="Step 2"><p>Click the <span class="emphasis"><strong>Run</strong></span> button in the <span class="emphasis"><strong>Run</strong></span> view to launch the execution of your Route. You can also press <span class="emphasis"><strong>F6</strong></span> to execute it. </p><p>RESULT: The message is received by the consumer, as shown on the <span class="emphasis"><strong>Run</strong></span> console.</p><div class="mediaobject"><img src="../images/use_case_cjms7.png"></div></li></ol></div></div></div><div class="section" title="Scenario 2: Setting up a JMS local transaction"><div class="titlepage"><div><div><h3 class="title"><a name="lgaudens-20120419-camel_components-cjms_s2"></a>Scenario 2: Setting up a JMS local transaction</h3></div></div></div><p>In this scenario, a local transaction with three steps is performed to send, test and
			consume a JMS message:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>The first Route is used to send a <span class="emphasis"><em>"hello world!"</em></span>
					message to feed the <span class="emphasis"><em>queue.hello</em></span> JMS
					queue.</p></li><li class="listitem"><p>The second Route is used to test the received JMS message. This message is redelivered six
					times to the <span class="emphasis"><em>queue.hello</em></span> queue and is then
					moved to the <span class="emphasis"><em>Dead Letter</em></span> JMS queue. The Route
					is programmed to throw an exception every time an exchange is processed by the
					Route.</p></li><li class="listitem"><p>The last Route is used to consume the <span class="emphasis"><em>"hello world!"</em></span>
					message from the <span class="emphasis"><em>Dead Letter</em></span> JMS
					queue.</p></li></ol></div><div class="section" title="Sending a message to the queue.hello JMS queue"><div class="titlepage"><div><div><h4 class="title"><a name="d2670e6223"></a>Sending a message to the <span class="emphasis"><em>queue.hello</em></span> JMS queue</h4></div></div></div><div class="mediaobject"><img src="../images/use_case-cjms9.png"></div><div class="procedure" title="Procedure&nbsp;3.1.&nbsp;Dropping and linking the components"><a name="d2670e6232"></a><p class="title"><b>Procedure&nbsp;3.1.&nbsp;Dropping and linking the components</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>From the <span class="emphasis"><strong>Palette</strong></span>, drop the five following
						components onto the design workspace: one <span class="emphasis"><strong>cJMSConnectionFactory</strong></span>, one <span class="emphasis"><strong>cConfig</strong></span>, one <span class="emphasis"><strong>cMessagingEndpoint</strong></span>, one <span class="emphasis"><strong>cJMS</strong></span> and one <span class="emphasis"><strong>cProcessor</strong></span>
						component.</p></li><li class="step" title="Step 2"><p>Connect the <span class="emphasis"><strong>cMessagingEndpoint</strong></span> component
						to the <span class="emphasis"><strong>cJMS</strong></span> using a <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span>
						connection.</p></li><li class="step" title="Step 3"><p>Connect the <span class="emphasis"><strong>cJMS</strong></span> component to the
							<span class="emphasis"><strong>cProcessor</strong></span> component using a <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span>
						connection.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;3.2.&nbsp;Configuring the components"><a name="d2670e6286"></a><p class="title"><b>Procedure&nbsp;3.2.&nbsp;Configuring the components</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component
						labelled <span class="emphasis"><em>AMQ_Send_ConnectionFactory</em></span> to
						display its <span class="emphasis"><strong>Basic settings</strong></span> view in the
							<span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms15.png"></div></li><li class="step" title="Step 2"><p>From the <span class="emphasis"><strong>MQ Server</strong></span> list, select an MQ
						server. In this use case, we use the default ActiveMQ server to handle the
						messages. </p></li><li class="step" title="Step 3"><p>In the <span class="emphasis"><strong>Broker URI</strong></span> field,  type in Active
						MQ's default URI of the localhost server: <span class="emphasis"><em>"tcp://localhost:61616"</em></span>.</p><div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p> When using ActiveMQ to handle messages between different Routes, you
							need to launch the ActiveMQ server before executing the Routes. For more
							information on installing and launching ActiveMQ server, see the section
							about installing Apache ActiveMQ in the <span class="emphasis"><em>Talend ESB
								Installation Guide</em></span>. </p></div></li><li class="step" title="Step 4"><p>Double-click the <span class="emphasis"><strong>cConfig</strong></span> component, which is labelled
							<span class="emphasis"><em>DatasetConfig</em></span>, to display its
							<span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab and set its parameters. </p><p>
						</p><div class="mediaobject"><img src="../images/use_case-cjms16.png"></div><p>
					</p></li><li class="step" title="Step 5"><p> Write a piece of code in the <span class="emphasis"><strong>Code</strong></span> field
						to register the dataset instance <span class="emphasis"><em>hello</em></span>
						into the registry, as shown below. </p><pre class="programlisting">org.apache.camel.component.dataset.SimpleDataSet dataset = new 
org.apache.camel.component.dataset.SimpleDataSet(1);
dataset.setDefaultBody("Test Data: hello world!");
org.apache.camel.impl.SimpleRegistry registry = new  
org.apache.camel.impl.SimpleRegistry();
     registry.put("hello",dataset);
camelContext.setRegistry(registry); </pre></li><li class="step" title="Step 6"><p>Double-click the <span class="emphasis"><strong>cMessagingEndpoint</strong></span>
						component, which is labelled <span class="emphasis"><em>SimpleDatasetGen</em></span>, to display its <span class="emphasis"><strong>Basic
							settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab. and set its parameters. </p><p>
						</p><div class="mediaobject"><img src="../images/use_case-cjms17.png"></div><p>
					</p></li><li class="step" title="Step 7"><p>In the <span class="emphasis"><strong>URI</strong></span> field, enter
							<span class="emphasis"><em>dataset:hello</em></span> between the quotation marks. </p></li><li class="step" title="Step 8"><p>Double-click the <span class="emphasis"><strong>cJMS</strong></span> component labeled
							<span class="emphasis"><em>AMQ_Send</em></span> to display its <span class="emphasis"><strong>Basic settings</strong></span> view.</p><div class="mediaobject"><img src="../images/use_case-cjms17bis.png"></div></li><li class="step" title="Step 9"><p>From the <span class="emphasis"><strong>Type</strong></span> list, select <span class="emphasis"><strong>queue</strong></span> to send the message to a JMS queue.</p><p>In the <span class="emphasis"><strong>Destination</strong></span> field, type in a name
						for the JMS queue, <span class="emphasis"><em>"queue.hello"</em></span> in this
						use case.</p><p>Double-click the <span class="emphasis"><strong>[...]</strong></span> button next to <span class="emphasis"><strong>ConnectionFactory</strong></span>. Select the JMS connection
						factory that you have just configured in the dialog box and click <span class="emphasis"><strong>OK</strong></span>. You can also enter the name of the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component directly in the
						field.</p><div class="mediaobject"><img src="../images/use_case-cjms17ter.png"></div></li><li class="step" title="Step 10"><p>Double-click the <span class="emphasis"><strong>cProcessor</strong></span> component labelled <span class="emphasis"><em>PrintSendMsg</em></span> to display its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab, and customize the code in the <span class="emphasis"><strong>Code</strong></span> area to display the sent message intercepted
						on the console.</p><pre class="programlisting">System.out.println("AMQ Send: "+
exchange.getIn().getBody(String.class));</pre></li></ol></div><div class="procedure" title="Procedure&nbsp;3.3.&nbsp;Executing the Route"><a name="d2670e6459"></a><p class="title"><b>Procedure&nbsp;3.3.&nbsp;Executing the Route</b></p><ul class="procedure"><li class="step" title="Step 1"><p>Click the <span class="emphasis"><strong>Run</strong></span> button in the <span class="emphasis"><strong>Run</strong></span> view to launch the execution of your Route.
						You can also press <span class="emphasis"><strong>F6</strong></span> to execute it. </p><p>RESULT: One <span class="emphasis"><em>"hello world!"</em></span> message is
						sent to the JMS Queue, as shown in the <span class="emphasis"><strong>Run</strong></span>
						console.</p><div class="mediaobject"><img src="../images/use_case-cjms18.png"></div></li></ul></div></div><div class="section" title="Testing the received message"><div class="titlepage"><div><div><h4 class="title"><a name="d2670e6485"></a>Testing the received message</h4></div></div></div><div class="mediaobject"><img src="../images/use_case-cjms8.png"></div><div class="procedure" title="Procedure&nbsp;3.4.&nbsp;Dropping and linking the components"><a name="d2670e6491"></a><p class="title"><b>Procedure&nbsp;3.4.&nbsp;Dropping and linking the components</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>From the <span class="emphasis"><strong>Palette</strong></span>, drop the four following
						components onto the design workspace: one <span class="emphasis"><strong>cJMS</strong></span>, two <span class="emphasis"><strong>cProcessor</strong></span>
						components and one <span class="emphasis"><strong>cJMSConnectionFactory</strong></span>.</p></li><li class="step" title="Step 2"><p>Connect the <span class="emphasis"><strong>cJMS</strong></span> component to the first <span class="emphasis"><strong>cProcessor</strong></span> using a <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span>
						connection.</p></li><li class="step" title="Step 3"><p>Connect the first <span class="emphasis"><strong>cProcessor</strong></span> component to the second
							<span class="emphasis"><strong>cProcessor</strong></span> component using a <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span>
						connection.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;3.5.&nbsp;Configuring the components"><a name="d2670e6539"></a><p class="title"><b>Procedure&nbsp;3.5.&nbsp;Configuring the components</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component
						labelled <span class="emphasis"><em>AMQ_Rev_ConnectionFactory</em></span> to
						display its <span class="emphasis"><strong>Basic settings</strong></span> view in the
							<span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms11.png"></div></li><li class="step" title="Step 2"><p>From the <span class="emphasis"><strong>MQ Server</strong></span> list, select an MQ
						server. In this use case, we use the default ActiveMQ server to handle the
						messages. </p><p>Select the <span class="emphasis"><strong>Use transaction</strong></span> check box.</p></li><li class="step" title="Step 3"><p>In the <span class="emphasis"><strong>Broker URI</strong></span> field,  type in Active
						MQ's default URI of the localhost server: <span class="emphasis"><em>"tcp://localhost:61616"</em></span>.</p></li><li class="step" title="Step 4"><p>Double-click the <span class="emphasis"><strong>cJMS</strong></span> component labeled
							<span class="emphasis"><em>AMQ_Rev</em></span> to display its <span class="emphasis"><strong>Basic settings</strong></span> view.</p><div class="mediaobject"><img src="../images/use_case-cjms12.png"></div></li><li class="step" title="Step 5"><p>From the <span class="emphasis"><strong>Type</strong></span> list, select <span class="emphasis"><strong>queue</strong></span> to send the messages to a JMS queue.</p><p>In the <span class="emphasis"><strong>Destination</strong></span> field, type in a name for the JMS
						queue, <span class="emphasis"><em>"queue.hello"</em></span> in this use
						case.</p><p>Double-click the <span class="emphasis"><strong>[...]</strong></span> button next to <span class="emphasis"><strong>ConnectionFactory</strong></span>. Select the JMS connection
						factory that you have just configured in the dialog box and click <span class="emphasis"><strong>OK</strong></span>. You can also enter the name of the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component directly in the
						field.</p><div class="mediaobject"><img src="../images/use_case-cjms13.png"></div></li><li class="step" title="Step 6"><p>Double-click the first <span class="emphasis"><strong>cProcessor</strong></span> component labelled
							<span class="emphasis"><em>PrintRevMsg</em></span> to display its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab, and customize the code in the <span class="emphasis"><strong>Code</strong></span> area to display the received message
						intercepted on the console.</p><pre class="programlisting">System.out.println("AMQ Receive: "+
exchange.getIn().getBody(String.class));</pre></li><li class="step" title="Step 7"><p>Double-click the second <span class="emphasis"><strong>cProcessor</strong></span> component labelled
							<span class="emphasis"><em>ThrowEx</em></span> to display its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab, and customize the code in the <span class="emphasis"><strong>Code</strong></span> area to throw the <span class="emphasis"><em>Force fail</em></span> exception every time an exchange is processed by
						the route.</p><pre class="programlisting">throw new Exception("Force fail")</pre></li></ol></div><div class="procedure" title="Procedure&nbsp;3.6.&nbsp;Executing the Route"><a name="d2670e6672"></a><p class="title"><b>Procedure&nbsp;3.6.&nbsp;Executing the Route</b></p><ul class="procedure"><li class="step" title="Step 1"><p>Click the <span class="emphasis"><strong>Run</strong></span> button in the <span class="emphasis"><strong>Run</strong></span> view to launch the execution of your Route.
						You can also press <span class="emphasis"><strong>F6</strong></span> to execute it. </p><p>RESULT: The <span class="emphasis"><em>"hello world!"</em></span> message is tested and a
						rollback transaction is performed. Once the message redelivery attempts
						exceeds six times, the pending message is sent to the <span class="emphasis"><em>Dead Letter</em></span> JMS Queue.</p></li></ul></div></div><div class="section" title="Consuming the message from the DeadLetter JMS queue"><div class="titlepage"><div><div><h4 class="title"><a name="d2670e6695"></a>Consuming the message from the <span class="emphasis"><em>DeadLetter</em></span> JMS
				queue</h4></div></div></div><div class="mediaobject"><img src="../images/use_case-cjms10.png"></div><div class="procedure" title="Procedure&nbsp;3.7.&nbsp;Dropping and linking the components"><a name="d2670e6704"></a><p class="title"><b>Procedure&nbsp;3.7.&nbsp;Dropping and linking the components</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>From the <span class="emphasis"><strong>Palette</strong></span>, drop the three
						following components onto the design workspace: one <span class="emphasis"><strong>cJMSConnectionFactory</strong></span>, one <span class="emphasis"><strong>cJMS</strong></span> and one <span class="emphasis"><strong>cProcessor</strong></span>
						component.</p></li><li class="step" title="Step 2"><p>Connect the <span class="emphasis"><strong>cJMS</strong></span> component to the
							<span class="emphasis"><strong>cProcessor</strong></span> component using a <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span>
						connection.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;3.8.&nbsp;Configuring the components"><a name="d2670e6737"></a><p class="title"><b>Procedure&nbsp;3.8.&nbsp;Configuring the components</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span>
						component to display its <span class="emphasis"><strong>Basic settings</strong></span>
						view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms19.png"></div></li><li class="step" title="Step 2"><p>From the <span class="emphasis"><strong>MQ Server</strong></span> list, select an MQ
						server. In this use case, we use the default ActiveMQ server to handle the
						messages. </p></li><li class="step" title="Step 3"><p>In the <span class="emphasis"><strong>Broker URI</strong></span> field, type in Active
						MQ's default URI of the localhost server: <span class="emphasis"><em>"tcp://localhost:61616"</em></span>.</p></li><li class="step" title="Step 4"><p>Double-click the <span class="emphasis"><strong>cJMS</strong></span> component labeled
							<span class="emphasis"><em>DeadLetterQueueJMS</em></span> to display its
							<span class="emphasis"><strong>Basic settings</strong></span> view.</p><div class="mediaobject"><img src="../images/use_case-cjms20.png"></div></li><li class="step" title="Step 5"><p>From the <span class="emphasis"><strong>Type</strong></span> list, select <span class="emphasis"><strong>queue</strong></span> to send the messages to a JMS queue.</p><p>In the <span class="emphasis"><strong>Destination</strong></span> field, type in a name
						for the JMS queue, <span class="emphasis"><em>"ActiveMQ.DLQ"</em></span> in this
						use case (the default <span class="emphasis"><em>Dead Letter</em></span> Queue
						in ActiveMQ).</p><p>Double-click the <span class="emphasis"><strong>[...]</strong></span> button next to <span class="emphasis"><strong>ConnectionFactory</strong></span>. Select the JMS connection
						factory that you have just configured in the dialog box and click <span class="emphasis"><strong>OK</strong></span>. You can also enter the name of the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component directly in the
						field.</p><div class="mediaobject"><img src="../images/use_case-cjms21.png"></div></li><li class="step" title="Step 6"><p>Double-click the <span class="emphasis"><strong>cProcessor</strong></span> component
						labelled <span class="emphasis"><em>PrintMsg</em></span> to display its
							<span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab, and customize the code in the
							<span class="emphasis"><strong>Code</strong></span> area to display the received
						message intercepted on the console.</p><pre class="programlisting">System.out.println("AMQ Receive: "+ 
exchange.getIn().getBody(String.class));</pre></li></ol></div><div class="procedure" title="Procedure&nbsp;3.9.&nbsp;Executing the Route"><a name="d2670e6842"></a><p class="title"><b>Procedure&nbsp;3.9.&nbsp;Executing the Route</b></p><ul class="procedure"><li class="step" title="Step 1"><p>Click the <span class="emphasis"><strong>Run</strong></span> button in the <span class="emphasis"><strong>Run</strong></span> view to launch the execution of your Route.
						You can also press <span class="emphasis"><strong>F6</strong></span> to execute it. </p><p>RESULT: The <span class="emphasis"><em>"hello world!"</em></span> message that
						was in the <span class="emphasis"><em>Dead Letter</em></span> queue is consumed,
						as shown in the <span class="emphasis"><strong>Run</strong></span> console.</p><div class="mediaobject"><img src="../images/use_case-cjms22.png"></div></li></ul></div></div></div><div class="section" title="Scenario 3: Sending and receiving a scheduled delivery of messages from a JMS Queue using Camel Quartz"><div class="titlepage"><div><div><h3 class="title"><a name="d2670e6871"></a>Scenario 3: Sending and receiving a scheduled delivery of messages from a JMS Queue using Camel Quartz</h3></div></div></div><p>This scenario will show you how to use the Camel Quartz component to provide a scheduled delivery of messages from a JMS Queue. </p><p>To do this, we will build two Routes, a message producer Route and a consumer Route. We will implement the Quartz component in the producer Route to send scheduled messages to a JMS Queue. The messages are then consumed by the consumer Route.</p><p>In this use case, we will use Apache ActiveMQ as the message broker. We need to launch the ActiveMQ server before executing the Route. For more information about installing and launching ActiveMQ server, see the site <a class="link" href="http://activemq.apache.org/index.html" target="_top">http://activemq.apache.org/index.html</a>.</p><div class="section" title="Building the producer Route"><div class="titlepage"><div><div><h4 class="title"><a name="d2670e6883"></a>Building the producer Route</h4></div></div></div><div class="procedure" title="Procedure&nbsp;3.10.&nbsp;Dropping and linking the components"><a name="d2670e6886"></a><p class="title"><b>Procedure&nbsp;3.10.&nbsp;Dropping and linking the components</b></p><div class="mediaobject"><img src="../images/use_case-cjms23.png"></div><ol class="procedure" type="1"><li class="step" title="Step 1"><p>From the <span class="emphasis"><strong>Palette</strong></span>, drag and drop a <span class="emphasis"><strong>cJMSConnectionFactory</strong></span>, a <span class="emphasis"><strong>cJMS</strong></span>, a <span class="emphasis"><strong>cSetBody</strong></span>, and two <span class="emphasis"><strong>cMessagingEndpoint</strong></span> components onto the design workspace. </p></li><li class="step" title="Step 2"><p>Label the components for better identification of their roles and link them with the <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span> connection as shown above.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;3.11.&nbsp;Configuring the components"><a name="d2670e6919"></a><p class="title"><b>Procedure&nbsp;3.11.&nbsp;Configuring the components</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component to display its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms24.png"></div></li><li class="step" title="Step 2"><p>From the <span class="emphasis"><strong>MQ Server</strong></span> list, select <span class="emphasis"><strong>ActiveMQ</strong></span> to handle messages. </p><p>In the <span class="emphasis"><strong>Broker URI</strong></span> field, type in the URI of the local Active MQ server, <span class="emphasis"><em>"tcp://localhost:61616"</em></span>.</p><p>Select the <span class="emphasis"><strong>Use PooledConnectionFatory</strong></span> check box and keep the default settings.</p></li><li class="step" title="Step 3"><p>Double-click the <span class="emphasis"><strong>quartzConsumer</strong></span> component to open its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms25.png"></div></li><li class="step" title="Step 4"><p>In the <span class="emphasis"><strong>URI</strong></span> field, enter the code <code class="code">"quartz://HelloWorld?trigger.repeatInterval=2000&amp;trigger.repeatCount=-1"</code> to define a timer for starting message exchanges. In this use case, we want the message to be delivered endlessly between an interval of two seconds. For more information about Quartz, see the site <a class="link" href="http://camel.apache.org/quartz.html" target="_top">http://camel.apache.org/quartz.html</a>.</p></li><li class="step" title="Step 5"><p>Click the <span class="emphasis"><strong>Advanced settings</strong></span> view. Click <span class="inlinemediaobject"><img src="../images/plus_button.png"></span> at the bottom of the <span class="emphasis"><strong>Dependencies</strong></span> list to add a row and select <code class="code">quartz</code> from the drop-down list. For more information about the Quartz component, see the site <a class="link" href="http://camel.apache.org/quartz.html" target="_top">http://camel.apache.org/quartz.html</a>.</p><div class="mediaobject"><img src="../images/use_case-cjms35.png"></div></li><li class="step" title="Step 6"><p>Double-click the <span class="emphasis"><strong>cSetBody</strong></span> component to open its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms26.png"></div></li><li class="step" title="Step 7"><p>Select <span class="emphasis"><strong>Simple</strong></span> from the <span class="emphasis"><strong>Language</strong></span> list box and type in <code class="code">"Hello world"</code> in the <span class="emphasis"><strong>Expression</strong></span> field.</p></li><li class="step" title="Step 8"><p>Double-click the <span class="emphasis"><strong>logMessage</strong></span> component to open its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms27.png"></div></li><li class="step" title="Step 9"><p>In the <span class="emphasis"><strong>URI</strong></span> field, enter <code class="code">"log:quartzMessage"</code> where the message exchanges are logged.</p></li><li class="step" title="Step 10"><p>Double-click the <span class="emphasis"><strong>jmsProducer</strong></span> component to display its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms28.png"></div></li><li class="step" title="Step 11"><p>From the <span class="emphasis"><strong>Type</strong></span> list, select <span class="emphasis"><strong>queue</strong></span> to send the messages to a JMS queue.</p><p>In the <span class="emphasis"><strong>Destination</strong></span> field, type in a name for the JMS queue, <code class="code">"quartzTest"</code> in this use case.</p><p>In the <span class="emphasis"><strong>ConnectionFactory</strong></span> field, enter the name of the JMS connection factory that you have just configured.</p></li><li class="step" title="Step 12"><p>Press <span class="emphasis"><strong>Ctrl+S</strong></span> to save your Route.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;3.12.&nbsp;Viewing the code and executing the Route"><a name="d2670e7105"></a><p class="title"><b>Procedure&nbsp;3.12.&nbsp;Viewing the code and executing the Route</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Click the <span class="emphasis"><strong>Code</strong></span> tab at the bottom of the design workspace to check the generated code.</p><div class="mediaobject"><img src="../images/use_case-cjms29.png"></div><p>As shown above, the message flow from <code class="code">quartzConsumer</code> is given a payload by <code class="code">cSetBody_1</code> and then sent to <code class="code">logMessage</code> and <code class="code">jmsProducer</code>.</p></li><li class="step" title="Step 2"><p>Press <span class="emphasis"><strong>F6</strong></span> to execute the Route.</p><p>RESULT: The logs of the message exchange are printed in the console.</p><div class="mediaobject"><img src="../images/use_case-cjms30.png"></div></li></ol></div></div><div class="section" title="Building the consumer Route"><div class="titlepage"><div><div><h4 class="title"><a name="d2670e7142"></a>Building the consumer Route</h4></div></div></div><div class="procedure" title="Procedure&nbsp;3.13.&nbsp;Dropping and linking the components"><a name="d2670e7145"></a><p class="title"><b>Procedure&nbsp;3.13.&nbsp;Dropping and linking the components</b></p><div class="mediaobject"><img src="../images/use_case-cjms31.png"></div><ol class="procedure" type="1"><li class="step" title="Step 1"><p>From the <span class="emphasis"><strong>Palette</strong></span>, drag and drop a <span class="emphasis"><strong>cJMSConnectionFactory</strong></span>, a <span class="emphasis"><strong>cJMS</strong></span>, and a <span class="emphasis"><strong>cMessagingEndpoint</strong></span> component onto the design workspace. </p></li><li class="step" title="Step 2"><p>Label the components for better identification of their roles and link them with the <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span> connection as shown above.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;3.14.&nbsp;Configuring the components"><a name="d2670e7175"></a><p class="title"><b>Procedure&nbsp;3.14.&nbsp;Configuring the components</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Double-click the <span class="emphasis"><strong>cJMSConnectionFactory</strong></span> component to display its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms24.png"></div></li><li class="step" title="Step 2"><p>Configure the <span class="emphasis"><strong>cJMSConnectionFatory</strong></span> component the same as in the producer Route.</p></li><li class="step" title="Step 3"><p>Double-click the <span class="emphasis"><strong>jmsConsumer</strong></span> component to display its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms32.png"></div></li><li class="step" title="Step 4"><p>Configure the <span class="emphasis"><strong>jmsConsumer</strong></span> component the same as the <span class="emphasis"><strong>jmsProducer</strong></span> component in the producer Route to consume the messages in the defined queue <code class="code">"quartzTest"</code>.</p></li><li class="step" title="Step 5"><p>Double-click the <span class="emphasis"><strong>logMessage</strong></span> component to open its <span class="emphasis"><strong>Basic settings</strong></span> view in the <span class="emphasis"><strong>Component</strong></span> tab.</p><div class="mediaobject"><img src="../images/use_case-cjms27.png"></div></li><li class="step" title="Step 6"><p>In the <span class="emphasis"><strong>URI</strong></span> field, enter <code class="code">"log:quartzMessage"</code> where the message exchanges are logged.</p></li><li class="step" title="Step 7"><p>Press <span class="emphasis"><strong>Ctrl+S</strong></span> to save your Route.</p></li></ol></div><div class="procedure" title="Procedure&nbsp;3.15.&nbsp;Viewing the code and executing the Route"><a name="d2670e7256"></a><p class="title"><b>Procedure&nbsp;3.15.&nbsp;Viewing the code and executing the Route</b></p><ol class="procedure" type="1"><li class="step" title="Step 1"><p>Click the <span class="emphasis"><strong>Code</strong></span> tab at the bottom of the design workspace to check the generated code.</p><div class="mediaobject"><img src="../images/use_case-cjms33.png"></div><p>As shown above, the message flow is routed from <code class="code">jmsConsumer</code> to <code class="code">logMessage</code>.</p></li><li class="step" title="Step 2"><p>Press <span class="emphasis"><strong>F6</strong></span> to execute the Route.</p><p>RESULT: The logs of the message exchange are printed in the console.</p><div class="mediaobject"><img src="../images/use_case-cjms34.png"></div></li></ol></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cHttp.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch-messaging.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="cMail.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">cHttp&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="bk-tos-esb-mediationcomponents-rg-en..html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;cMail</td></tr></table></div></body></html>