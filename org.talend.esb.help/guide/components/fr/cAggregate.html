<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>cAggregate</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="bk-tos-esb-mediationcomponents-rg-fr..html" title="Talend Open Studio"><link rel="up" href="ch-routing.html" title="Chapitre&nbsp;6.&nbsp;Composants Routing"><link rel="prev" href="ch-routing.html" title="Chapitre&nbsp;6.&nbsp;Composants Routing"><link rel="next" href="cDynamicRouter.html" title="cDynamicRouter"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">cAggregate</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch-routing.html">Pr&eacute;c&eacute;dent</a>&nbsp;</td><th width="60%" align="center">Chapitre&nbsp;6.&nbsp;Composants Routing</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="cDynamicRouter.html">Suivant</a></td></tr></table><hr></div><div lang="fr" class="section" title="cAggregate"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cAggregate"></a>cAggregate</h2></div></div></div><div class="mediaobject"><img src="../images/caggregate_icon32.png"></div><div class="section" title="Propri&eacute;t&eacute;s du cAggregate"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12260"></a>Propri&eacute;t&eacute;s du cAggregate</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Famille de composant</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Routing</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Fonction</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le composant <span class="emphasis"><strong>cAggregate</strong></span> agr&egrave;ge des messages selon des
								conditions sp&eacute;cifi&eacute;es.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Objectif</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le <span class="emphasis"><strong>cAggregate</strong></span> vous permet de combiner un certain
								nombre de messages en un seul message.</p>
						</td></tr><tr><td rowspan="8" valign="top">
							<p>
								<span class="emphasis"><strong>Basic settings</strong></span>
							</p>
							<p> </p>
							<p>&nbsp;</p>
						</td><td valign="top">
							<p><span class="emphasis"><em>Language</em></span>
							</p>
						</td><td valign="top">S&eacute;lectionnez le langage de l'expression que vous souhaitez utiliser pour
							filtrer vos messages, entre <span class="emphasis"><strong>Constant</strong></span>,
								<span class="emphasis"><strong>EL</strong></span>, <span class="emphasis"><strong>Groovy</strong></span>, <span class="emphasis"><strong>Header</strong></span>,
								<span class="emphasis"><strong>Javascript</strong></span>, <span class="emphasis"><strong>JoSQL</strong></span>, <span class="emphasis"><strong>JXPath</strong></span>,
								<span class="emphasis"><strong>MVEL</strong></span>, <span class="emphasis"><strong>None</strong></span>, <span class="emphasis"><strong>OGNL</strong></span>, <span class="emphasis"><strong>PHP</strong></span>, <span class="emphasis"><strong>Property</strong></span>, <span class="emphasis"><strong>Python</strong></span>,
								<span class="emphasis"><strong>Ruby</strong></span>, <span class="emphasis"><strong>Simple</strong></span>, <span class="emphasis"><strong>SpEL</strong></span>, <span class="emphasis"><strong>SQL</strong></span>, <span class="emphasis"><strong>XPath</strong></span>,
							et <span class="emphasis"><strong>XQuery</strong></span>.</td></tr><tr><td valign="top">
							<p><span class="emphasis"><em>Correlation expression/Expression</em></span>
							</p>
						</td><td valign="top">
							<p>Saisissez l'expression &eacute;valuant la cl&eacute; de corr&eacute;lation &agrave; utiliser pour
								l'agr&eacute;gation.</p>
						</td></tr><tr><td valign="top"><span class="emphasis"><em>Strategy</em></span>
						</td><td valign="top">Sp&eacute;cifiez un bean Java &agrave; utiliser comme strat&eacute;gie d'agr&eacute;gation.</td></tr><tr><td valign="top"><span class="emphasis"><em>Completion conditions/Number of
								messages</em></span>
						</td><td valign="top"><p>Cochez cette case pour sp&eacute;cifier le nombre de messages &agrave; agr&eacute;ger par lot avant que l'op&eacute;ration
								d'agr&eacute;gation soit compl&egrave;te.</p>
							<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Cette case est coch&eacute;e par d&eacute;faut et le nombre de messages est d&eacute;fini &agrave; <span class="emphasis"><em>3</em></span>. Si vous d&eacute;cochez cette case et
									qu'au moins l'une des quatre autres conditions de compl&eacute;tion est
									rencontr&eacute;e, tous les messages r&eacute;cup&eacute;r&eacute;s sont agr&eacute;g&eacute;s en un
									lot.</p></div>
						</td></tr><tr><td valign="top"><span class="emphasis"><em>Completion conditions/Inactivity timeout (in
								milliseconds)</em></span>
						</td><td valign="top">
							<p>Cochez cette case pour sp&eacute;cifier la dur&eacute;e (en millisecondes) qu'un &eacute;change agr&eacute;g&eacute; doit
								rester inactif pour &ecirc;tre complet. Cette option peut &ecirc;tre d&eacute;finie
								soit comme une valeur fixe soit &agrave; l'aide d'une Expression qui vous
								permet d'&eacute;valuer dynamiquement le d&eacute;lai avant suspension. </p>
							<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Vous ne pouvez utiliser cette option avec <span class="emphasis"><strong>Scheduled
										interval</strong></span>. Une seule d'entre elles peut &ecirc;tre
									utilis&eacute;e &agrave; la fois.</p></div>
						</td></tr><tr><td valign="top"><span class="emphasis"><em>Completion conditions/Scheduled interval (in
								milliseconds)</em></span>
						</td><td valign="top">
							<p>Cochez cette case pour sp&eacute;cifier un intervalle de temps (en millisecondes) &agrave; la fin
								duquel les &eacute;changes de messages seront agr&eacute;g&eacute;s. </p>
							<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Vous ne pouvez utiliser cette option avec <span class="emphasis"><strong>Inactivity
										timeout</strong></span>. Une seule d'entre elles peut &ecirc;tre
									utilis&eacute;e &agrave; la fois.</p></div>
						</td></tr><tr><td valign="top"><span class="emphasis"><em>Completion conditions/Predicate
								matched</em></span>
						</td><td valign="top">Cochez cette case pour sp&eacute;cifier un pr&eacute;dicat &agrave; indiquer lorsqu'un &eacute;change
							agr&eacute;g&eacute; est termin&eacute;.</td></tr><tr><td valign="top"><span class="emphasis"><em>Completion conditions/Batch
								consumer</em></span>
						</td><td valign="top">Cochez cette case pour agr&eacute;ger tous les fichiers consomm&eacute;s &agrave; partir de
							l'endpoint de fichiers &agrave; l'emplacement sp&eacute;cifi&eacute;.</td></tr><tr><td rowspan="9" valign="top">
							<span class="emphasis"><strong>Advanced settings</strong></span>
						</td><td valign="top"><span class="emphasis"><em>Check completion before aggregating</em></span>
						</td><td valign="top">Cochez cette case afin de v&eacute;rifier la compl&eacute;tion lorsqu'un nouvel &eacute;change
							entrant est re&ccedil;u. Cette option influence le comportement de l'option
								<span class="emphasis"><strong>Predicate matched</strong></span> car l'&eacute;change
							pass&eacute; change. Lorsque cette option est d&eacute;sactiv&eacute;e, l'&eacute;change pass&eacute; dans
							le pr&eacute;dicat est l'&eacute;change <span class="emphasis"><em>aggregated</em></span>,
							ce qui signifie que toute information stock&eacute;e dans l'&eacute;change agr&eacute;g&eacute; par
							la strat&eacute;gie d'agr&eacute;gation est disponible pour le pr&eacute;dicat. Lorsque cette
							option est activ&eacute;e, l'&eacute;change pass&eacute; dans le pr&eacute;dicat est l'&eacute;change
								<span class="emphasis"><em>incoming</em></span>, ce qui signifie que
							vous pouvez acc&eacute;der aux donn&eacute;es de l'&eacute;change entrant. </td></tr><tr><td valign="top"><span class="emphasis"><em>Close correlation group</em></span>
						</td><td valign="top">Cochez cette case pour indiquer qu'une cl&eacute; de corr&eacute;lation &agrave; d&eacute;j&agrave; &eacute;t&eacute;
							compl&eacute;t&eacute;e. Tout &eacute;change ayant la m&ecirc;me cl&eacute; de corr&eacute;lation sera refus&eacute;.
							lorsque vous utilisez cette option, saisissez un nombre dans le champ
								<span class="emphasis"><strong>Maximum bound</strong></span> afin de n'avoir qu'un
							nombre ferm&eacute; de cl&eacute;s de corr&eacute;lation.</td></tr><tr><td valign="top"><span class="emphasis"><em>Ignore invalid correlation key</em></span>
						</td><td valign="top">Cochez cette case pour ignorer une cl&eacute; de corr&eacute;lation invalide ne pouvant
							&ecirc;tre &eacute;valu&eacute;e comme une valeur. Par d&eacute;faut Camel va retourner une
							Exception lorsqu'il rencontre une cl&eacute; de corr&eacute;lation invalide. </td></tr><tr><td valign="top"><span class="emphasis"><em>Group arriving exchange</em></span>
						</td><td valign="top">Cochez cette case pour grouper tous les &eacute;changes agr&eacute;g&eacute;s en un seul objet
							contenant tous les &eacute;changes agr&eacute;g&eacute;s. Un seul message Exchange est envoy&eacute;
							depuis l'Aggregator. Cette option peut &ecirc;tre utilis&eacute;e pour combiner
							plusieurs messages de type Exchange entrants en un seul message Exchange
							de sortie.</td></tr><tr><td valign="top"><span class="emphasis"><em>Use persistence</em></span></td><td valign="top">Cochez cette case pour s&eacute;lectionner votre propre impl&eacute;mentation du
							r&eacute;f&eacute;rentiel conservant une trace des &eacute;changes agr&eacute;g&eacute;s en cours
							d'agr&eacute;gation. Par d&eacute;faut, Camel utilise une impl&eacute;mentation bas&eacute;e
							m&eacute;moire.</td></tr><tr><td valign="top"><span class="emphasis"><em>Repository</em></span></td><td valign="top">Ce champ appara&icirc;t lorsque la case <span class="emphasis"><strong>Use
								persistence</strong></span> est coch&eacute;e. Le r&eacute;f&eacute;rentiel peut &ecirc;tre
								<span class="emphasis"><strong>AggregationRepository</strong></span>, <span class="emphasis"><strong>HawtDBAggregationRepository</strong></span>, ou <span class="emphasis"><strong>RecoverableAggregationRepository</strong></span>.</td></tr><tr><td valign="top">&nbsp;</td><td valign="top"><span class="emphasis"><strong>AggregationRepository</strong></span> : Le r&eacute;f&eacute;rentiel
							par d&eacute;faut utilis&eacute; par Camel est une impl&eacute;mentation bas&eacute;e m&eacute;moire.
							Saisissez le nom du r&eacute;f&eacute;rentiel dans le champ.</td></tr><tr><td valign="top">&nbsp;</td><td valign="top">
							<p><span class="emphasis"><strong>HawtDBAggregationRepository</strong></span> :
								HawtDBAggregationRepository est un AggregationRepository faisant
								persister les messages agr&eacute;g&eacute;s &agrave; la vol&eacute;e. Cela vous assure de ne
								pas perdre vos messages. Avec ce r&eacute;f&eacute;rentiel s&eacute;lectionn&eacute;, les
								options suivantes apparaissent :</p>
							<p><span class="emphasis"><strong>Use persistent file</strong></span> : Cochez cette case pour stocker
								les &eacute;changes agr&eacute;g&eacute;s dans un fichier. Saisissez le nom du fichier
								pour le stockage persistant dans le champ <span class="emphasis"><strong>Persistent file</strong></span>. Si le fichier n'existe pas, il sera
								cr&eacute;&eacute;. </p>
							<p><span class="emphasis"><strong>Recovery/Use recovery</strong></span> : Cochez cette case pour
								r&eacute;cup&eacute;rer les &eacute;changes agr&eacute;g&eacute;s ayant &eacute;chou&eacute; et les soumettre &agrave;
								nouveau automatiquement. Dans le champ <span class="emphasis"><strong>Recovery interval</strong></span>, saisissez l'intervalle (en
								millisecondes) de temps au bout duquel chercher les &eacute;changes &eacute;chou&eacute;s
								&agrave; reprendre et &agrave; soumettre &agrave; nouveau. Cet intervalle est par d&eacute;faut
								de 5000 millisecondes. Dans le champ <span class="emphasis"><strong>Dead
									letter channel</strong></span>, saisissez une URI d'endpoint pour un
								canal des messages perdus dans lequel tous les messages Exchange
								r&eacute;cup&eacute;r&eacute;s seront d&eacute;plac&eacute;s. Dans le champ <span class="emphasis"><strong>Maximum redeliveries</strong></span>, saisissez le nombre maximal de
								tentatives de livraison pour un &eacute;change r&eacute;cup&eacute;r&eacute;.</p>
						</td></tr><tr><td valign="top">&nbsp;</td><td valign="top">
							<p><span class="emphasis"><strong>RecoverableAggregationRepository</strong></span> :
								RecoverableAggregationRepository est un JDBC bas&eacute; sur un
								AggregationRepository faisant persister les messages agr&eacute;g&eacute;s &agrave; la
								vol&eacute;e. Cela vous assure de ne pas perdre vos messages. Saisissez le
								nom du r&eacute;f&eacute;rentiel dans le champ.</p>
							<p>En s&eacute;lectionnant ce r&eacute;f&eacute;rentiel, les options suivantes apparaissent :</p>
							<p><span class="emphasis"><strong>Recovery/Use recovery</strong></span> : Cochez cette case pour
								r&eacute;cup&eacute;rer les &eacute;changes agr&eacute;g&eacute;s ayant &eacute;chou&eacute; et les soumettre &agrave;
								nouveau automatiquement. Dans le champ <span class="emphasis"><strong>Recovery interval</strong></span>, saisissez l'intervalle (en
								millisecondes) de temps au bout duquel chercher les &eacute;changes &eacute;chou&eacute;s
								&agrave; reprendre et &agrave; soumettre &agrave; nouveau. Cet intervalle est par d&eacute;faut
								de 5000 millisecondes. Dans le champ <span class="emphasis"><strong>Dead
									letter channel</strong></span>, saisissez une URI d'endpoint pour un
								canal des messages perdus dans lequel tous les messages Exchange
								r&eacute;cup&eacute;r&eacute;s seront d&eacute;plac&eacute;s. Dans le champ <span class="emphasis"><strong>Maximum redeliveries</strong></span>, saisissez le nombre maximal de
								tentatives de livraison pour un &eacute;change r&eacute;cup&eacute;r&eacute;.</p>
						</td></tr><tr><td valign="top">
							<p>
								<span class="emphasis"><strong>Utilisation</strong></span>
							</p>
						</td><td colspan="2" valign="top">
							<p>Le composant <span class="emphasis"><strong>cAggregate</strong></span> peut &ecirc;tre utilis&eacute; comme
								composant de milieu ou de fin dans une Route.</p>
						</td></tr><tr><td rowspan="2" valign="top"><span class="emphasis"><strong>Connections</strong></span></td><td valign="top"><span class="emphasis"><em>Aggregate</em></span></td><td valign="top">S&eacute;lectionnez ce lien pour router des messages vers
							l'endpoint suivant, selon la strat&eacute;gie d'agr&eacute;gation
							s&eacute;lectionn&eacute;e.</td></tr><tr><td valign="top"><span class="emphasis"><em>Route</em></span></td><td valign="top">S&eacute;lectionnez ce lien pour router tous les messages de
							l'&eacute;metteur vers l'endpoint suivant.</td></tr><tr><td valign="top">
							<span class="emphasis"><strong>Limitation</strong></span>
						</td><td colspan="2" valign="top">n/a</td></tr></tbody></table></div></div><div class="section" title="Sc&eacute;nario : Agr&eacute;ger trois messages en un"><div class="titlepage"><div><div><h3 class="title"><a name="d0e12654"></a>Sc&eacute;nario : Agr&eacute;ger trois messages en un</h3></div></div></div><p>Dans ce sc&eacute;nario, le composant <span class="emphasis"><strong>cAggregate</strong></span> combine trois
			messages du syst&egrave;me de fichiers local en un seul et affiche les messages dans la
			console. Un bean Java est utilis&eacute; comme strat&eacute;gie d'agr&eacute;gation.</p><div class="section" title="Cr&eacute;er un bean Java comme strat&eacute;gie d'agr&eacute;gation"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12662"></a>Cr&eacute;er un bean Java comme strat&eacute;gie d'agr&eacute;gation</h4></div></div></div><p>Pour agr&eacute;ger les messages, utilisez un bean Java qui vous permet de construire une
				strat&eacute;gie d'agr&eacute;gation.</p><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Dans la vue <span class="emphasis"><strong>Repository</strong></span>, d&eacute;veloppez le n&#339;ud <span class="emphasis"><strong>Code</strong></span> et cliquez-droit sur le n&#339;ud <span class="emphasis"><strong>Beans</strong></span>. Dans le menu contextuel, s&eacute;lectionnez
							<span class="emphasis"><strong>Create Bean</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_caggregate2.png"></div></li><li class="step" title="&Eacute;tape 2"><p>L'assistant <span class="emphasis"><strong>[New Bean]</strong></span> s'ouvre. Dans le champ <span class="emphasis"><strong>Name</strong></span>, saisissez un nom pour le bean, par exemple
							<span class="emphasis"><em>AggregateBody</em></span>. Cliquez sur <span class="emphasis"><strong>Finish</strong></span> pour fermer l'assistant.</p><div class="mediaobject"><img src="../images/use_case_caggregate3.png"></div></li><li class="step" title="&Eacute;tape 3"><p>Saisissez les codes comme ci-dessous. Dans ce sc&eacute;nario, agr&eacute;gez tous les message en un
						seul.</p><p>
						</p><pre class="programlisting">package beans;

import org.apache.camel.Exchange;
import org.apache.camel.processor.aggregate.AggregationStrategy;

public class AggregateBody implements AggregationStrategy{

	public Exchange aggregate(Exchange oldEx, Exchange newEx) {
		if(oldEx==null){
			return newEx;
		}
		String oldBody = oldEx.getIn().getBody(String.class);
		String newBody = newEx.getIn().getBody(String.class);
		newEx.getIn().setBody(oldBody+newBody);
		return newEx;
	}
}</pre><p>
					</p></li><li class="step" title="&Eacute;tape 4"><p>Appuyez sur <span class="emphasis"><strong>Ctrl+S</strong></span> pour sauvegarder votre bean.</p></li></ol></div></div><div class="section" title="D&eacute;poser et relier les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12718"></a>D&eacute;poser et relier les composants</h4></div></div></div><div class="mediaobject"><img src="../images/use_case_caggregate1.png"></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Dans la <span class="emphasis"><strong>Palette</strong></span>, d&eacute;veloppez le dossier <span class="emphasis"><strong>Messaging</strong></span>. S&eacute;lectionnez le composant <span class="emphasis"><strong>cFile</strong></span> et d&eacute;posez-le dans l'espace de mod&eacute;lisation
						graphique.</p></li><li class="step" title="&Eacute;tape 2"><p>D&eacute;veloppez le dossier <span class="emphasis"><strong>Routing</strong></span>. S&eacute;lectionnez le composant
							<span class="emphasis"><strong>cAggregate</strong></span> et d&eacute;posez-le dans l'espace
						de mod&eacute;lisation graphique.</p></li><li class="step" title="&Eacute;tape 3"><p>D&eacute;veloppez le dossier <span class="emphasis"><strong>Processor</strong></span>. S&eacute;lectionnez deux
						composants <span class="emphasis"><strong>cProcessor</strong></span> et d&eacute;posez-les dans
						l'espace de mod&eacute;lisation graphique.</p></li><li class="step" title="&Eacute;tape 4"><p>Cliquez-droit sur le composant <span class="emphasis"><strong>cFile</strong></span>, s&eacute;lectionnez
							<span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span> dans le menu contextuel et cliquez sur le premier
						composant <span class="emphasis"><strong>cProcessor</strong></span>.</p></li><li class="step" title="&Eacute;tape 5"><p>R&eacute;p&eacute;tez cette op&eacute;ration pour connecter le premier <span class="emphasis"><strong>cProcessor</strong></span> au composant <span class="emphasis"><strong>cAggregate</strong></span>. </p></li><li class="step" title="&Eacute;tape 6"><p>Cliquez-droit sur le composant <span class="emphasis"><strong>cAggregate</strong></span>, s&eacute;lectionnez
							<span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Aggregate</strong></span> dans le menu contextuel et cliquez sur le second
							<span class="emphasis"><strong>cProcessor</strong></span>.</p></li><li class="step" title="&Eacute;tape 7"><p>Renommez tous les composants, si vous le souhaitez, afin de mieux identifier leur
						fonctionnalit&eacute;, comme dans la capture d'&eacute;cran ci-dessus.</p></li></ol></div></div><div class="section" title="Configurer les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12797"></a>Configurer les composants</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le <span class="emphasis"><strong>cFile</strong></span> nomm&eacute; <span class="emphasis"><em>File_source</em></span>, pour afficher sa vue <span class="emphasis"><strong>Basic settings</strong></span> dans l'onglet <span class="emphasis"><strong>Component</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_caggregate5.png"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans le champ <span class="emphasis"><strong>Path</strong></span>, parcourez votre syst&egrave;me ou saisissez
						le chemin d'acc&egrave;s &agrave; votre fichier d'entr&eacute;e. Laissez les autres champs tels
						qu'ils sont. </p><p>Dans ce sc&eacute;nario, quatre fichiers texte se trouvent dans le r&eacute;pertoire sp&eacute;cifi&eacute; :
							<span class="emphasis"><em>a.txt</em></span>, <span class="emphasis"><em>b.txt</em></span>,
							<span class="emphasis"><em>c.txt</em></span> et <span class="emphasis"><em>d.txt</em></span>. Ils
						contiennent respectivement la phrase suivante <span class="emphasis"><em>This is a!
						</em></span>, <span class="emphasis"><em>This is b! </em></span>, <span class="emphasis"><em>This
							is c! </em></span> et <span class="emphasis"><em>This is d! </em></span>.</p></li><li class="step" title="&Eacute;tape 3"><p>Double-cliquez sur le composant <span class="emphasis"><strong>cAggregate</strong></span> nomm&eacute;
							<span class="emphasis"><em>Aggregator</em></span>, pour afficher sa vue
							<span class="emphasis"><strong>Basic settings</strong></span> dans l'onglet <span class="emphasis"><strong>Component</strong></span>.</p><div class="mediaobject"><img src="../images/use_case_caggregate6.png"></div></li><li class="step" title="&Eacute;tape 4"><p>Dans le champ <span class="emphasis"><strong>Language</strong></span>, s&eacute;lectionnez <span class="emphasis"><strong>Constant</strong></span> ou <span class="emphasis"><strong>Simple</strong></span> comme langage d'expression.</p><p>Dans le champ <span class="emphasis"><strong>Expression</strong></span>, saisissez
						l'expression <code class="code">"getBody(String.class)"</code> pour r&eacute;cup&eacute;rer le corps du
						message.</p><p>Dans le champ <span class="emphasis"><strong>Strategy</strong></span>, saisissez le nom
						du bean Java <span class="emphasis"><em>AggregateBody</em></span> que vous avez cr&eacute;&eacute;.</p><p>Cochez la case <span class="emphasis"><strong>Number of messages</strong></span> et
						saisissez <span class="emphasis"><em>2</em></span> dans le champ.</p></li><li class="step" title="&Eacute;tape 5"><p>Double-cliquez sur le composant <span class="emphasis"><strong>cProcessor</strong></span> nomm&eacute;
							<span class="emphasis"><em>Monitor_before</em></span> pour afficher sa vue
							<span class="emphasis"><strong>Basic settings</strong></span> dans l'onglet <span class="emphasis"><strong>Component</strong></span>. </p><div class="mediaobject"><img src="../images/use_case_caggregate7.png"></div></li><li class="step" title="&Eacute;tape 6"><p>Dans le champ <span class="emphasis"><strong>Code</strong></span>, personnalisez le code comme suit,
						afin que la console de la vue <span class="emphasis"><strong>Run</strong></span> affiche
						le contenu du message avant que l'op&eacute;ration d'agr&eacute;gation soit effectu&eacute;e
						:</p><pre class="programlisting">System.out.println("Before aggregation: "+
exchange.getIn().getBody(String.class));</pre><p>
					</p></li><li class="step" title="&Eacute;tape 7"><p>De la m&ecirc;me fa&ccedil;on, configurez le composant <span class="emphasis"><strong>cProcessor</strong></span>
						nomm&eacute; <span class="emphasis"><em>Monitor_after</em></span> afin que la console
						de la vue <span class="emphasis"><strong>Run</strong></span> affiche le contenu du message
						apr&egrave;s l'op&eacute;ration d'agr&eacute;gation : </p><pre class="programlisting">System.out.println("After aggregation: "+
exchange.getIn().getBody(String.class));</pre><p>
					</p></li><li class="step" title="&Eacute;tape 8"><p>Appuyez sur les touches <span class="emphasis"><strong>Ctrl+S</strong></span> pour sauvegarder votre
						route.</p></li></ol></div></div><div class="section" title="Visualiser du code et ex&eacute;cuter la Route"><div class="titlepage"><div><div><h4 class="title"><a name="d0e12958"></a>Visualiser du code et ex&eacute;cuter la Route</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur l'onglet <span class="emphasis"><strong>Code</strong></span> au bas de l'espace de
						mod&eacute;lisation graphique afin de visualiser le code g&eacute;n&eacute;r&eacute;.</p><div class="mediaobject"><img src="../images/use_case_caggregate9.png"></div><p>Comme affich&eacute; dans le code, un message provenant (<code class="code">from</code>) de l'endpoint
							<code class="code">File_source</code> est rout&eacute; via le <code class="code">cProcessor_1</code> puis
						agr&eacute;g&eacute; selon la condition <code class="code">.aggregate</code>.</p></li><li class="step" title="&Eacute;tape 2"><p>Cliquez sur la vue <span class="emphasis"><strong>Run</strong></span> pour l'afficher et cliquez sur le
						bouton <span class="emphasis"><strong>Run</strong></span> pour lancer l'ex&eacute;cution de votre
						route. Vous pouvez &eacute;galement appuyer sur <span class="emphasis"><strong>F6</strong></span>
						pour l'ex&eacute;cuter. </p><p>R&eacute;sultat : Les quatre messages sont agr&eacute;g&eacute;s en deux lots, deux messages combin&eacute;s en un
						par lot. </p><div class="mediaobject"><img src="../images/use_case_caggregate10.png"></div></li></ol></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch-routing.html">Pr&eacute;c&eacute;dent</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch-routing.html">Niveau sup&eacute;rieur</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="cDynamicRouter.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">Chapitre&nbsp;6.&nbsp;Composants Routing&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="bk-tos-esb-mediationcomponents-rg-fr..html">Sommaire</a></td><td width="40%" align="right" valign="top">&nbsp;cDynamicRouter</td></tr></table></div></body></html>