<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>cSetBody</title><meta name="generator" content="DocBook XSL-NS Stylesheets V1.75.2"><link rel="home" href="bk-tos-esb-mediationcomponents-rg-fr..html" title="Talend Open Studio"><link rel="up" href="ch-transformation.html" title="Chapitre&nbsp;7.&nbsp;Composants Transformation"><link rel="prev" href="cConvertBodyTo.html" title="cConvertBodyTo"><link rel="next" href="cSetHeader.html" title="cSetHeader"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">cSetBody</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="cConvertBodyTo.html">Pr&eacute;c&eacute;dent</a>&nbsp;</td><th width="60%" align="center">Chapitre&nbsp;7.&nbsp;Composants Transformation</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="cSetHeader.html">Suivant</a></td></tr></table><hr></div><div lang="fr" class="section" title="cSetBody"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="cSetBody"></a>cSetBody</h2></div></div></div><div class="mediaobject"><img src="../images/cSetBody_icon32.png"></div><div class="section" title="Propri&eacute;t&eacute;s du cSetBody"><div class="titlepage"><div><div><h3 class="title"><a name="d0e20133"></a>Propri&eacute;t&eacute;s du cSetBody</h3></div></div></div><div class="informaltable"><table border="1"><colgroup><col><col><col></colgroup><tbody><tr><td valign="top"><p><span class="emphasis"><strong>Famille de composant</strong></span></p>
						</td><td colspan="2" valign="top"><p>Transformation</p>
						</td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Fonction</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le composant <span class="emphasis"><strong>cSetBody</strong></span> remplace le payload de chaque message
								envoy&eacute; &agrave; ce composant.</p>
						</td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Objectif</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le <span class="emphasis"><strong>cSetBody</strong></span> est utilis&eacute; pour remplacer le contenu de chaque
								message qui lui est envoy&eacute; selon la valeur de l'expression.</p>
						</td></tr><tr><td valign="top">
							<p><span class="emphasis"><strong>Basic settings</strong></span></p>
						</td><td valign="top"><span class="emphasis"><em>Language</em></span></td><td valign="top"><p>S&eacute;lectionnez le langage de l'expression utilis&eacute;e pour configurer le contenu des messages mis
								en correspondance, parmi <span class="emphasis"><strong>Constant</strong></span>,
									<span class="emphasis"><strong>EL</strong></span>, <span class="emphasis"><strong>Groovy</strong></span>, <span class="emphasis"><strong>Header</strong></span>,
									<span class="emphasis"><strong>JavaScript</strong></span>, <span class="emphasis"><strong>JoSQL</strong></span>, <span class="emphasis"><strong>JXPath</strong></span>, <span class="emphasis"><strong>MVEL</strong></span>,
									<span class="emphasis"><strong>None</strong></span>, <span class="emphasis"><strong>OGNL</strong></span>, <span class="emphasis"><strong>PHP</strong></span>,
									<span class="emphasis"><strong>Property</strong></span>, <span class="emphasis"><strong>Python</strong></span>, <span class="emphasis"><strong>Ruby</strong></span>,
									<span class="emphasis"><strong>Simple</strong></span>, <span class="emphasis"><strong>SpEL</strong></span>, <span class="emphasis"><strong>SQL</strong></span>,
									<span class="emphasis"><strong>XPath</strong></span>, et <span class="emphasis"><strong>XQuery</strong></span>.</p></td></tr><tr><td><p>&nbsp;</p>
						</td><td valign="top"><p><span class="emphasis"><em>Expression</em></span></p>
						</td><td valign="top"><p>Saisissez l'expression permettant de configurer le contenu du message.</p>
						</td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Utilisation</strong></span></p>
						</td><td colspan="2" valign="top"><p>Le <span class="emphasis"><strong>cSetBody</strong></span> est utilis&eacute; comme composant interm&eacute;diaire dans
								une Route.</p>
						</td></tr><tr><td valign="top"><p><span class="emphasis"><strong>Limitation</strong></span></p>
						</td><td colspan="2"><p>&nbsp;n/a</p>
						</td></tr></tbody></table></div></div><div class="section" title="Sc&eacute;nario : Remplacer le contenu des messages par leurs extraits"><div class="titlepage"><div><div><h3 class="title"><a name="d0e20285"></a>Sc&eacute;nario : Remplacer le contenu des messages par leurs extraits </h3></div></div></div><p>Dans ce sc&eacute;nario, des messages de fichiers sont rout&eacute;s d'un endpoint &agrave; un autre, avec
			le contenu de chaque message remplac&eacute; par les informations extraites de celui-ci.</p><p>Voici un exemple des fichiers XML utilis&eacute;s dans ce sc&eacute;nario :</p><p>
			</p><pre class="programlisting">&lt;people&gt;
    &lt;person&gt;
        &lt;firstName&gt;Pierre&lt;/firstName&gt;
        &lt;lastName&gt;Dubois&lt;/lastName&gt;
        &lt;city&gt;Paris&lt;/city&gt;
    &lt;/person&gt;
&lt;/people&gt;</pre><p>
		</p><div class="section" title="D&eacute;poser et relier les composants"><div class="titlepage"><div><div><h4 class="title"><a name="d0e20297"></a>D&eacute;poser et relier les composants</h4></div></div></div><p>Ce sc&eacute;nario utilise deux composants <span class="emphasis"><strong>cFile</strong></span>, un
				comme &eacute;metteur des messages et l'autre comme r&eacute;cepteur, un <span class="emphasis"><strong>cSetBody</strong></span> pour remplacer le contenu des messages de la Route et un
					<span class="emphasis"><strong>cProcessor</strong></span> pour afficher le nouveau contenu des
				messages rout&eacute;s vers l'endpoint r&eacute;cepteur.</p><div class="mediaobject"><img src="../images/use_case-csetbody1.png"></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Dans la <span class="emphasis"><strong>Palette</strong></span>, d&eacute;veloppez le dossier
							<span class="emphasis"><strong>Messaging</strong></span>, et d&eacute;posez deux composants
							<span class="emphasis"><strong>cFile</strong></span> dans l'espace de mod&eacute;lisation
						graphique.</p></li><li class="step" title="&Eacute;tape 2"><p>Dans le dossier <span class="emphasis"><strong>Transformation</strong></span>, d&eacute;posez
						un <span class="emphasis"><strong>cSetBody</strong></span> dans l'espace de mod&eacute;lisation
						graphique, entre les deux composants <span class="emphasis"><strong>cFile</strong></span>.</p></li><li class="step" title="&Eacute;tape 3"><p>Du dossier <span class="emphasis"><strong>Processor</strong></span>, d&eacute;posez un
							<span class="emphasis"><strong>cProcessor</strong></span> dans l'espace de
						mod&eacute;lisation graphique, &agrave; la suite du second composant <span class="emphasis"><strong>cFile</strong></span>.</p></li><li class="step" title="&Eacute;tape 4"><p>Cliquez-droit sur le premier <span class="emphasis"><strong>cFile</strong></span>,
						s&eacute;lectionnez <span class="emphasis"><strong>Row</strong></span> &gt; <span class="emphasis"><strong>Route</strong></span> dans le menu contextuel et cliquez sur le composant
							<span class="emphasis"><strong>cSetBody</strong></span>.</p></li><li class="step" title="&Eacute;tape 5"><p>R&eacute;p&eacute;tez cette op&eacute;ration pour relier le <span class="emphasis"><strong>cSetBody</strong></span> au second <span class="emphasis"><strong>cFile</strong></span> et
						le second composant <span class="emphasis"><strong>cFile</strong></span> au <span class="emphasis"><strong>cProcessor</strong></span>.</p></li><li class="step" title="&Eacute;tape 6"><p>Renommez les composants afin de mieux identifier leur r&ocirc;le dans la Route,
						comme ci-dessus.</p></li></ol></div></div><div class="section" title="Configurer les composants et les connexions"><div class="titlepage"><div><div><h4 class="title"><a name="d0e20384"></a>Configurer les composants et les connexions</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Double-cliquez sur le composant <span class="emphasis"><strong>cFile</strong></span>
						nomm&eacute; <span class="emphasis"><em>Sender</em></span> pour afficher sa vue
							<span class="emphasis"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-csetbody2.png"></div></li><li class="step" title="&Eacute;tape 2"><p>Dans le champ <span class="emphasis"><strong>Path</strong></span>, saisissez le chemin
						d'acc&egrave;s au dossier contenant les fichiers source ou parcourez votre syst&egrave;me
						jusqu'&agrave; ce dossier.</p></li><li class="step" title="&Eacute;tape 3"><p>Dans la liste <span class="emphasis"><strong>Encoding</strong></span>, s&eacute;lectionnez le
						type d'encodage des fichiers source. Laissez les autres param&egrave;tres tels
						qu'ils sont.</p></li><li class="step" title="&Eacute;tape 4"><p>R&eacute;p&eacute;tez ces &eacute;tapes pour d&eacute;finir le chemin d'acc&egrave;s au fichier de sortie
						ainsi que son type d'encodage, dans la vue <span class="emphasis"><strong>Basic
							settings</strong></span> de l'autre composant <span class="emphasis"><strong>cFile</strong></span> nomm&eacute; <span class="emphasis"><em>Receiver</em></span>.
					</p></li><li class="step" title="&Eacute;tape 5"><p>Double-cliquez sur le <span class="emphasis"><strong>cSetBody</strong></span> pour
						afficher sa vue <span class="emphasis"><strong>Basic settings</strong></span>.</p><div class="mediaobject"><img src="../images/use_case-csetbody3.png"></div></li><li class="step" title="&Eacute;tape 6"><p>Dans la liste <span class="emphasis"><strong>Language</strong></span>, s&eacute;lectionnez le
						langage de l'expression que vous utilisez. </p><p>Comme vous g&eacute;rez des fichiers XML, s&eacute;lectionnez <span class="emphasis"><strong>XPath</strong></span> dans la liste.</p></li><li class="step" title="&Eacute;tape 7"><p>Dans le champ <span class="emphasis"><strong>Expression</strong></span>, saisissez
						l'expression qui retournera le contenu du nouveau message souhait&eacute;.</p><p>Dans ce sc&eacute;nario, <span class="emphasis"><em>person</em></span> doit &ecirc;tre
						l'&eacute;l&eacute;ment racine de chaque fichier lorsqu'il est rout&eacute; vers l'endpoint
						r&eacute;cepteur, saisissez <code class="code">"/people/person"</code> dans le champ <span class="emphasis"><strong>Expression</strong></span>.</p></li><li class="step" title="&Eacute;tape 8"><p>Double-cliquez sur le composant <span class="emphasis"><strong>cProcessor</strong></span> pour afficher sa vue <span class="emphasis"><strong>Basic
							settings</strong></span> et personnalisez le code afin que la console affiche
						les informations comme vous le souhaitez.</p><p>Dans ce sc&eacute;nario, vous devez afficher le nom du fichier ainsi que le
						contenu de chaque message rout&eacute; vers l'endpoint r&eacute;cepteur, personnalisez le
						code, comme suit : </p><pre class="programlisting">System.out.println("File received: " +
exchange.getIn().getHeader("CamelFileName") + 
"\nContent:\n " + 
exchange.getIn().getBody(String.class));</pre></li><li class="step" title="&Eacute;tape 9"><p>Appuyez sur <span class="emphasis"><strong>Ctrl+S</strong></span> pour sauvegarder votre
						Route.</p></li></ol></div></div><div class="section" title="Visualiser le code et ex&eacute;cuter la Route"><div class="titlepage"><div><div><h4 class="title"><a name="d0e20486"></a>Visualiser le code et ex&eacute;cuter la Route</h4></div></div></div><div class="procedure"><ol class="procedure" type="1"><li class="step" title="&Eacute;tape 1"><p>Cliquez sur l'onglet <span class="emphasis"><strong>Code</strong></span> au bas de
						l'espace de mod&eacute;lisation graphique pour visualiser le code g&eacute;n&eacute;r&eacute;.</p><div class="mediaobject"><img src="../images/use_case-csetbody6.png"></div><p>Dans ce morceau de code, une route de messages est construite &agrave; partir
						(<code class="code">from</code>) d'un endpoint vers (<code class="code">.to</code>) un autre et, lors
						du routage, le contenu de chaque message est remplac&eacute; selon la condition
							<code class="code">.xpath("/people/person")</code> par le
						<code class="code">"cSetBody_1"</code>.</p></li><li class="step" title="&Eacute;tape 2"><p>Cliquez sur la vue <span class="emphasis"><strong>Run</strong></span> pour l'afficher et cliquez sur le
						bouton <span class="emphasis"><strong>Run</strong></span> pour lancer l'ex&eacute;cution de votre
						Route. Vous pouvez &eacute;galement appuyer sur <span class="emphasis"><strong>F6</strong></span>
						pour l'ex&eacute;cuter. </p><div class="mediaobject"><img src="../images/use_case-csetbody7.png"></div><p>R&eacute;sultat : Les fichiers XML sont envoy&eacute;s au r&eacute;cepteur, dans lequel <span class="emphasis"><em>person</em></span> devient l'&eacute;l&eacute;ment racine de chaque
						fichier.</p></li></ol></div></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="cConvertBodyTo.html">Pr&eacute;c&eacute;dent</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch-transformation.html">Niveau sup&eacute;rieur</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="cSetHeader.html">Suivant</a></td></tr><tr><td width="40%" align="left" valign="top">cConvertBodyTo&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="bk-tos-esb-mediationcomponents-rg-fr..html">Sommaire</a></td><td width="40%" align="right" valign="top">&nbsp;cSetHeader</td></tr></table></div></body></html>